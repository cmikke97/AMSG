name: AMSG_workflow

conda_env: conda.yaml

entry_points:
  download_dataset:
    parameters:
      destination_dir: string
    command: "python src/Sorel20mDataset/sorel20mDownloader.py sorel20m_download
                --destination_dir {destination_dir}"

  preprocess_dataset:
    parameters:
      ds_path: path
      destination_dir: string
      training_n_samples: {type: int, default: -1}
      validation_n_samples: {type: int, default: -1}
      test_n_samples: {type: int, default: -1}
      batch_size: {type: int, default: 8192}
      remove_missing_features: string
    command: "python src/Sorel20mDataset/preprocess_dataset.py preprocess_dataset
                --ds_path {ds_path}
                --destination_dir {destination_dir}
                --training_n_samples {training_n_samples}
                --validation_n_samples {validation_n_samples}
                --test_n_samples {test_n_samples}
                --batch_size {batch_size}
                --remove_missing_features {remove_missing_features}"

  train_network:
    parameters:
      ds_path: path
      training_run: {type: int, default: 0}
      batch_size: {type: int, default: 8192}
      epochs: {type: int, default: 10}
      training_n_samples: {type: int, default: -1}
      validation_n_samples: {type: int, default: -1}
      use_malicious_labels: {type: int, default: 1}
      use_count_labels: {type: int, default: 1}
    command: "python src/JointEmbedding/train.py train_network
                --ds_path {ds_path}
                --training_run {training_run}
                --batch_size {batch_size}
                --epochs {epochs}
                --training_n_samples {training_n_samples}
                --validation_n_samples {validation_n_samples}
                --use_malicious_labels {use_malicious_labels}
                --use_count_labels {use_count_labels}"

  evaluate_network:
    parameters:
      ds_path: path
      checkpoint_file: path
      batch_size: {type: int, default: 8192}
      test_n_samples: {type: int, default: -1}
      evaluate_malware: {type: int, default: 1}
      evaluate_count: {type: int, default: 1}
    command: "python src/JointEmbedding/evaluate.py evaluate_network
                --ds_path {ds_path}
                --checkpoint_file {checkpoint_file}
                --batch_size {batch_size}
                --test_n_samples {test_n_samples}
                --evaluate_malware {evaluate_malware}
                --evaluate_count {evaluate_count}"

  plot_tag_result:
    parameters:
      results_file: path
    command: "python src/JointEmbedding/plot.py plot_tag_result
                --results_file {results_file}"

  compute_all_scores:
    parameters:
      results_file: path
      zero_division: {type: int, default: 1}
    command: "python src/JointEmbedding/plot.py compute_all_scores
                --results_file {results_file}
                --zero_division {zero_division}"

  compute_mean_scores:
    parameters:
      results_file: path
      zero_division: {type: int, default: 1}
    command: "python src/JointEmbedding/plot.py compute_mean_scores
                --results_file {results_file}
                --zero_division {zero_division}"

  plot_all_roc_distributions:
    parameters:
      run_to_filename_json: path
    command: "python src/JointEmbedding/plot.py plot_all_roc_distributions
                --run_to_filename_json {run_to_filename_json}"

  main:
    parameters:
      base_dir: string
    command: "python src/main.py workflow
                --base_dir {base_dir}"

  build_fresh_dataset:
    parameters:
      dataset_dest_dir: string
    command: "python src/FreshDatasetBuilder/build_fresh_dataset.py build_fresh_dataset
                --dataset_dest_dir {dataset_dest_dir}"

  evaluate_fresh:
    parameters:
      ds_path: path
      checkpoint_path: path
      n_queries: {type: int, default: 100}
    command: "python src/JointEmbedding/evaluate_fresh.py evaluate_fresh
                --ds_path {ds_path}
                --checkpoint_path {checkpoint_path}
                --n_queries {n_queries}"