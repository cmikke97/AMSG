name: AMSG_workflow

conda_env: conda.yaml

entry_points:
  download_dataset:
    parameters:
      destination_dir: path
    command: "python src/DatasetDownloader/sorel20mDownloader.py sorel20m_download --destination_dir {destination_dir}"

  train_network:
    parameters:
      db_path: path
      training_n_samples: {type: int, default: -1}
      validation_n_samples: {type: int, default: -1}
      training_run: {type: int, default: 0}
      batch_size: {type: int, default: 8192}
      epochs: {type: int, default: 10}
      use_malicious_labels: {type: int, default: 1}
      use_count_labels: {type: int, default: 1}
      remove_missing_features: string
    command: "python src/JointEmbedding/train.py train_network
                --db_path {db_path}
                --training_n_samples {training_n_samples}
                --validation_n_samples {validation_n_samples}
                --training_run {training_run}
                --batch_size {batch_size}
                --epochs {epochs}
                --use_malicious_labels {use_malicious_labels}
                --use_count_labels {use_count_labels}
                --remove_missing_features {remove_missing_features}"

  evaluate_network:
    parameters:
      db_path: path
      checkpoint_file: path
      test_n_samples: {type: int, default: -1}
      batch_size: {type: int, default: 8192}
      evaluate_malware: {type: int, default: 1}
      evaluate_count: {type: int, default: 1}
      remove_missing_features: string
    command: "python src/JointEmbedding/evaluate.py evaluate_network
                --db_path {db_path}
                --checkpoint_file {checkpoint_file}
                --test_n_samples {test_n_samples}
                --batch_size {batch_size}
                --evaluate_malware {evaluate_malware}
                --evaluate_count {evaluate_count}
                --remove_missing_features {remove_missing_features}"

  main:
    parameters:
      base_dir: path
      runs: {type: int, default: 5}
      training_n_samples: {type: int, default: -1}
      validation_n_samples: {type: int, default: -1}
      test_n_samples: {type: int, default: None}
      batch_size: {type: int, default: 8192}
      epochs: {type: int, default: 10}
      use_malicious_labels: {type: int, default: 1}
      use_count_labels: {type: int, default: 1}
    command: "python src/main.py workflow
                --base_dir {base_dir}
                --runs {runs}
                --training_n_samples {training_n_samples}
                --validation_n_samples {validation_n_samples}
                --test_n_samples {test_n_samples}
                --batch_size {batch_size}
                --epochs {epochs}
                --use_malicious_labels {use_malicious_labels}
                --use_count_labels {use_count_labels}"