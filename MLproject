name: AMSG_workflow

conda_env: conda.yaml

entry_points:
  download_dataset:
    parameters:
      destination_dir: path
    command: "python src/DatasetDownloader/sorel20mDownloader.py sorel20m_download --destination_dir {destination_dir}"

  train_network:
    parameters:
      db_path: path
      training_n_samples: {type: int, default: -1}
      validation_n_samples: {type: int, default: -1}
      training_run: {type: int, default: 0}
      batch_size: {type: int, default: 8192}
      epochs: {type: int, default: 10}
      use_malicious_labels: {type: int, default: 1}
      use_count_labels: {type: int, default: 1}
      remove_missing_features: string
    command: "python src/JointEmbedding/train.py train_network
                --db_path {db_path}
                --training_n_samples {training_n_samples}
                --validation_n_samples {validation_n_samples}
                --training_run {training_run}
                --batch_size {batch_size}
                --epochs {epochs}
                --use_malicious_labels {use_malicious_labels}
                --use_count_labels {use_count_labels}
                --remove_missing_features {remove_missing_features}"

  evaluate_network:
    parameters:
      db_path: path
      checkpoint_file: path
      test_n_samples: {type: int, default: -1}
      batch_size: {type: int, default: 8192}
      evaluate_malware: {type: int, default: 1}
      evaluate_count: {type: int, default: 1}
      remove_missing_features: string
    command: "python src/JointEmbedding/evaluate.py evaluate_network
                --db_path {db_path}
                --checkpoint_file {checkpoint_file}
                --test_n_samples {test_n_samples}
                --batch_size {batch_size}
                --evaluate_malware {evaluate_malware}
                --evaluate_count {evaluate_count}
                --remove_missing_features {remove_missing_features}"

  plot_tag_result:
    parameters:
      results_file: path
    command: "python src/JointEmbedding/plot.py plot_tag_result
                --results_file {results_file}"

  compute_all_scores:
    parameters:
      results_file: path
      zero_division: {type: int, default: 1}
    command: "python src/JointEmbedding/plot.py compute_all_scores
                --results_file {results_file}
                --zero_division {zero_division}"

  compute_mean_scores:
    parameters:
      results_file: path
      zero_division: {type: int, default: 1}
    command: "python src/JointEmbedding/plot.py compute_mean_scores
                --results_file {results_file}
                --zero_division {zero_division}"

  plot_all_roc_distributions:
    parameters:
      run_to_filename_json: path
    command: "python src/JointEmbedding/plot.py plot_all_roc_distributions
                --run_to_filename_json {run_to_filename_json}"

  main:
    parameters:
      base_dir: path
      runs: {type: int, default: 5}
      training_n_samples: {type: int, default: -1}
      validation_n_samples: {type: int, default: -1}
      test_n_samples: {type: int, default: None}
      batch_size: {type: int, default: 8192}
      epochs: {type: int, default: 10}
      use_malicious_labels: {type: int, default: 1}
      use_count_labels: {type: int, default: 1}
    command: "python src/main.py workflow
                --base_dir {base_dir}
                --runs {runs}
                --training_n_samples {training_n_samples}
                --validation_n_samples {validation_n_samples}
                --test_n_samples {test_n_samples}
                --batch_size {batch_size}
                --epochs {epochs}
                --use_malicious_labels {use_malicious_labels}
                --use_count_labels {use_count_labels}"

  build_fresh_dataset:
    parameters:
      config_file: path
      raw_features_dest_path: path
    command: "python ./src/EmberFeaturesExtractor/ExtractFeaturesFromFile.py build_fresh_dataset
                --config_file {config_file}
                --raw_features_dest_path {raw_features_dest_path}"